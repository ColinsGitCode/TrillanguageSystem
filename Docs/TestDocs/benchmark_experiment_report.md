# Benchmark 实验报告：50 样本 Few-shot 效果验证

**实验 ID**: `exp_benchmark_50_20260209_140431`
**实验时间**: 2026-02-09
**实验目的**: 使用 50 条分类标注的 benchmark 短语，在改进后的评分器和示例选取策略下，系统验证 Few-shot 机制的有效性

---

## 1. 实验方法论改进

本次实验相比之前的 21 样本实验（`exp_round_local20plus_20260206_073637`），做了以下关键改进：

### 1.1 评分器修正
- **修复**: `calculateCompletenessScore()` 移除了基于内容长度（>500字）的加分项
- **替换为**: 三语 section 结构完整性检查（翻译 + 解释 + ≥2 例句）
- **影响**: 消除了 few-shot "输出变长即加分"的评分器偏差

### 1.2 示例选取优化
- **修复**: `getRelevantExamples()` 从 SQL `ORDER BY ABS(LENGTH(phrase) - ?)` 改为 JS 层 bigram 相似度重排
- **影响**: 示例匹配从"长度近邻"提升到"字符级语义近邻"

### 1.3 统计检验引入
- **新增**: `statisticsService.js` 提供配对 t-test、Wilcoxon 签名秩检验、95% CI、Cohen's d
- **影响**: 所有结论均有统计显著性支撑

### 1.4 样本量扩充
- **之前**: 21 条随机短语
- **现在**: 50 条分类标注短语（日常 15 / 技术 20 / 歧义 15）

---

## 2. 实验配置

| 参数 | 值 |
|------|------|
| 短语数 | 50 (3 类) |
| 轮次 | 2 (baseline + fewshot_r1) |
| Student 模型 | Qwen 2.5-7B (local) |
| Few-shot 数量 | 2 |
| minScore | 80 |
| tokenBudgetRatio | 0.18 |
| exampleMaxChars | 360 |
| contextWindow | 2048 |
| teacherFirst | true |
| 请求间隔 | 4.2s |

---

## 3. 总体结果

| 指标 | Baseline | Fewshot_r1 | Delta | 变化率 |
|------|-------:|-------:|-------:|-------:|
| 成功率 | 98% (49/50) | 98% (49/50) | 0 | - |
| 平均质量分 | 75.00 | 76.88 | **+1.88** | +2.5% |
| 平均 Tokens | 1028.78 | 1413.72 | +384.94 | +37.4% |
| 平均延迟 (ms) | 46,681 | 49,563 | +2,882 | +6.2% |
| 质量标准差 | 3.92 | 3.20 | -0.72 | -18.4% |
| 质量 CV% | 5.22% | 4.16% | -1.06pp | - |
| Gain/1k Extra Tokens | - | **4.88** | - | - |

### 关键发现

1. **质量提升统计显著**：均值差 +1.88 分，但幅度小于之前实验报告的 +7.33
2. **稳定性改善明显**：CV 从 5.22% 降至 4.16%，输出更一致
3. **成本换算效率下降**：4.88 分/1k extra tokens，低于之前的 14.14

### 与历史实验对比

| 对比项 | 21样本实验 (旧评分器) | 50样本实验 (新评分器) |
|------|-------:|-------:|
| 样本量 | 21 | 50 |
| Baseline 均质量 | 72.00 | 75.00 |
| Fewshot 均质量 | 79.33 | 76.88 |
| Delta Quality | +7.33 | +1.88 |
| Gain/1k Tokens | 14.14 | 4.88 |
| 统计显著 | 未检验 | **p=0.0005** |

**解读**: 旧评分器下 +7.33 的增益中，相当一部分来自评分器偏差（长度加分）。修正评分器后，真实提升为 **+1.88 分**，但仍具有统计显著性。

---

## 4. 统计检验结果

| 检验方法 | 结果 | 解读 |
|------|------|------|
| 配对样本数 | 48 | 排除双侧均失败的样本 |
| 配对 t-test p-value | **0.0005** | 远低于 0.05，强统计显著 |
| Wilcoxon 签名秩 p-value | **0.0010** | 非参数检验亦显著 |
| 95% 置信区间 | **[0.84, 2.83]** | 不包含 0，确认正向提升 |
| Cohen's d | **0.537** | 中等效应量 (medium) |

**结论**: Few-shot 注入带来的质量提升在 **两种统计检验** 下均高度显著（p < 0.001），效应量为中等水平。95% 置信区间的下界 0.84 表明，即使在最保守估计下，few-shot 仍带来约 0.84 分的质量增益。

---

## 5. 分类统计

### 5.1 按类别汇总

| 类别 | Baseline 均质量 | Fewshot 均质量 | Delta | Gain/1k Tokens | Baseline 成功 | Fewshot 成功 |
|------|-------:|-------:|-------:|-------:|-------:|-------:|
| 日常词汇 (15) | 73.47 | 77.20 | **+3.73** | **9.06** | 15/15 | 15/15 |
| 技术术语 (20) | 77.95 | 78.85 | +0.90 | 2.33 | 19/20 | 20/20 |
| 歧义/复杂 (15) | 77.80 | 79.21 | +1.41 | 3.75 | 15/15 | 14/15 |

### 5.2 分类分析

**日常词汇提升最大 (+3.73)**:
- 日常用语在 baseline 时质量最低（73.47），说明模型对简短口语表达处理较弱
- Few-shot 示例能有效传递"短语 → 完整三语卡片"的输出模式
- Gain/1k tokens 达 9.06，投资回报率最高

**技术术语提升最小 (+0.90)**:
- 技术术语在 baseline 时质量已较高（77.95），提升空间有限
- 模型对结构化知识的生成能力本身较强
- Few-shot 修复的主要是"成功率提升"（19/20 → 20/20）

**歧义/复杂表达中等提升 (+1.41)**:
- 歧义表达（如"水很深""带节奏"）需要语境理解
- Few-shot 通过示例传递了"歧义 → 多义位展开"的生成模式
- 但有 1 条失败（"信息茧房" fewshot 失败），说明复杂概念仍有挑战

---

## 6. 失败样本分析

| 短语 | Baseline | Fewshot | 分析 |
|------|------|------|------|
| 数据管道 | 失败 (q=0) | 成功 (q=84) | baseline 生成超时/JSON 解析失败，fewshot 示例引导后成功 |
| 信息茧房 | 成功 (q=78) | 失败 (q=0) | 复杂社会学概念，fewshot 注入后 token 预算紧张导致输出截断 |

**成功率**: 两轮均为 98% (49/50)，互有胜负，整体稳定。

---

## 7. 自我批判与局限

### 7.1 评分器仍为规则驱动
当前 QualityChecker 使用固定规则（结构检查、关键词匹配），无法评估语义准确性、翻译流畅度等深层质量。修复了长度偏差后，评分器仍可能存在其他盲点。

### 7.2 Teacher 样本池为空
本次实验未预先注入 Teacher 参考样本（如 Gemini 生成的高质量输出），fewshot_r1 的示例来源为历史 golden examples。如果 Teacher 池充足，预期提升会更大。

### 7.3 Token 预算紧张
contextWindow=2048、tokenBudgetRatio=0.18 → 可用 token budget ≈ 368 tokens。两个示例各 360 chars 可能触发预算裁剪/回退，导致部分请求实际未注入完整示例。

### 7.4 单轮实验
仅对比 baseline vs fewshot_r1（单轮），未验证多轮渐进效果。后续应增加 r2/r3 轮次。

---

## 8. 结论

| 问题 | 答案 |
|------|------|
| Few-shot 是否有效？ | **是**，统计显著 (p=0.0005, Cohen's d=0.537) |
| 真实提升幅度？ | +1.88 分（修正评分器偏差后） |
| 哪类短语受益最大？ | 日常词汇 (+3.73)，baseline 质量越低、提升越大 |
| 成本代价？ | +37.4% tokens，+6.2% 延迟 |
| 稳定性？ | CV 从 5.22% 降至 4.16%，更稳定 |
| 旧实验 +7.33 可信吗？ | 约 5.45 分来自评分器偏差，真实贡献约 +1.88 |

---

## 9. 图表

### 质量趋势
![Quality Trend](charts/round_quality_trend_exp_benchmark_50_20260209_140431.svg)

### 增益效率
![Gain Efficiency](charts/round_gain_efficiency_exp_benchmark_50_20260209_140431.svg)

### 对齐与稳定性
![Alignment Stability](charts/round_alignment_stability_exp_benchmark_50_20260209_140431.svg)

### 增益-Token 散点
![Gain Tokens Scatter](charts/round_gain_tokens_scatter_exp_benchmark_50_20260209_140431.svg)

---

## 10. 数据文件

- `data/round_trend_exp_benchmark_50_20260209_140431.json` — 完整数据集
- `data/round_metrics_exp_benchmark_50_20260209_140431.csv` — 轮次指标 CSV
- `data/round_kpi_summary_exp_benchmark_50_20260209_140431.json` — KPI 摘要
- `data/benchmark_phrases_50.txt` — 50 条分类 benchmark 短语

---

*Generated: 2026-02-09 | Pipeline: run_fewshot_rounds.js → export_round_trend_dataset.js → render_round_trend_charts.mjs → generate_round_kpi_report.js*
