# 质量评价设计文档（GEMINI vs 本地 LLM）

**版本**: v1.0  
**日期**: 2026-02-06  
**目标**: 统一 GEMINI 与本地 LLM 的质量评价标准，保证对比结果可解释、可复盘、可改进。

---

## 1. 评价范围与目标

- **范围**：三语学习卡片生成（英文/日语/中文）
- **目标**：
  1) 评价生成质量（结构完整 / 准确 / 例句质量 / 格式规范）
  2) 支持双模型对比与 A/B 测试
  3) 为质量优化提供可执行的指标拆解

---

## 2. 当前评分标准（已实现）

### 2.1 评分维度与权重

| 维度 | 权重 | 含义 | 典型问题 |
|------|------|------|----------|
| completeness | 40 | 结构完整性 | 缺少语言段落、缺少翻译/解释/例句 |
| accuracy | 30 | 准确性 | 翻译偏题、输入短语未出现 |
| exampleQuality | 22 | 例句质量 | 例句过短、语义弱、模板化 |
| formatting | 8 | 格式规范 | Markdown/JSON 结构不合法、例句编号缺失 |

**总分**：四维度加权求和。

### 2.2 评价方法

- 入口：`QualityChecker.check(content, phrase)`
- 输入：`markdown_content` + `phrase`
- 输出：
  - `quality.score`
  - `quality.dimensions`
  - `quality.warnings`

---

## 3. 对比模式评价逻辑

- 同一短语并行生成 GEMINI / LOCAL
- 综合指标：
  - **质量分数**（主导）
  - **延迟**（辅助）
- Winner 判定：
  - `quality_score * 0.7 + speed_score * 0.3`

---

## 4. 可扩展指标（建议加入）

> 用于更细致的技术汇报与质量改善

### 4.1 结构合规率
- 是否包含 `英文/日语/中文` 三段
- 是否包含 `翻译/解释/例句1/例句2`

### 4.2 语言覆盖度
- 输入短语是否出现在翻译/解释
- 日语是否包含注音 / 外来语标注

### 4.3 例句强度
- 例句长度区间（英文 12–20 词 / 日语 12–20 字）
- 例句自然度（避免模板句）

### 4.4 JSON / Markdown 合规率
- JSON 是否可解析
- Markdown 是否符合模板

### 4.5 音频一致性
- `audio_tasks` 与例句编号一致性
- TTS 成功率（生成文件数 / 预期文件数）

---

## 5. 数据记录建议（用于绘图）

- `quality.score`（平均、分布）
- `quality.dimensions`（完整性/准确性/例句质量/格式）
- `prompt_tokens / output_tokens`（成本效率）
- `latency_total_ms`（性能开销）
- `json_valid / template_compliance`（结构稳定性）
- `tts_success_rate`（多媒体一致性）

---

## 6. 优化方向（与评价维度绑定）

| 维度 | 主要问题 | 优化方向 |
|------|----------|----------|
| completeness | 结构缺失 | 强化 prompt schema + auto-repair |
| accuracy | 偏题 / 词义漂移 | 输入短语强约束 + 关键词一致性检测 |
| exampleQuality | 例句弱 | 引入 Golden examples few-shot |
| formatting | 解析失败 | JSON 强制输出 + 后处理修复 |

---

## 7. 输出与报告建议

- 质量评分箱线图（baseline vs few-shot）
- 维度雷达图（completeness / accuracy / exampleQuality / formatting）
- 散点图（quality vs tokens）
- 成功率/失败率趋势图

---

**维护者**: Three LANS Team
**最后更新**: 2026-02-06
