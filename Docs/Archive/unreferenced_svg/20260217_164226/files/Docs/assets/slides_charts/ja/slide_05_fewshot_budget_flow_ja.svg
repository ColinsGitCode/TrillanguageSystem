<svg xmlns="http://www.w3.org/2000/svg" width="1280" height="720" style="background: rgb(255, 255, 255);"><defs><marker id="arrow" viewBox="0 -5 10 10" refX="9" refY="0" markerWidth="8" markerHeight="8" orient="auto"><path d="M0,-5L10,0L0,5" fill="#2F9BB2"></path></marker></defs><text x="40" y="56" font-family="'Yu Gothic','YuGothic','Hiragino Kaku Gothic ProN','Meiryo',sans-serif" font-size="34" font-weight="800" fill="#1F2937">few-shot注入と予算フォールバック</text><text x="40" y="86" font-family="'Yu Gothic','YuGothic','Hiragino Kaku Gothic ProN','Meiryo',sans-serif" font-size="16" fill="#64748B">目的：予算制御を維持しつつ生成品質を向上</text><rect x="40" y="190" width="200" height="82" rx="12" fill="#F8FCFD" stroke="#2F9BB2" stroke-width="3"></rect><text x="140" y="232" text-anchor="middle" font-family="'Yu Gothic','YuGothic','Hiragino Kaku Gothic ProN','Meiryo',sans-serif" font-size="20" font-weight="700" fill="#1F2937">入力語句</text><rect x="290" y="190" width="230" height="82" rx="12" fill="#F8FCFD" stroke="#2F9BB2" stroke-width="3"></rect><text x="405" y="224" text-anchor="middle" font-family="'Yu Gothic','YuGothic','Hiragino Kaku Gothic ProN','Meiryo',sans-serif" font-size="20" font-weight="700" fill="#1F2937">例示検索</text><text x="405" y="252" text-anchor="middle" font-family="'Yu Gothic','YuGothic','Hiragino Kaku Gothic ProN','Meiryo',sans-serif" font-size="16" fill="#334155">teacher生成例示を優先</text><rect x="560" y="190" width="220" height="82" rx="12" fill="#F8FCFD" stroke="#2F9BB2" stroke-width="3"></rect><text x="670" y="224" text-anchor="middle" font-family="'Yu Gothic','YuGothic','Hiragino Kaku Gothic ProN','Meiryo',sans-serif" font-size="20" font-weight="700" fill="#1F2937">品質選別</text><text x="670" y="252" text-anchor="middle" font-family="'Yu Gothic','YuGothic','Hiragino Kaku Gothic ProN','Meiryo',sans-serif" font-size="16" fill="#334155">score&gt;=85・類似度上位</text><polygon points="900,155 1000,230 900,305 800,230" fill="#F8FCFD" stroke="#2F9BB2" stroke-width="3"></polygon><text x="900" y="222" text-anchor="middle" font-family="'Yu Gothic','YuGothic','Hiragino Kaku Gothic ProN','Meiryo',sans-serif" font-size="17" font-weight="700" fill="#1F2937">予算</text><text x="900" y="252" text-anchor="middle" font-family="'Yu Gothic','YuGothic','Hiragino Kaku Gothic ProN','Meiryo',sans-serif" font-size="17" font-weight="700" fill="#1F2937">通過判定</text><rect x="1060" y="190" width="180" height="82" rx="12" fill="#F8FCFD" stroke="#2F9BB2" stroke-width="3"></rect><text x="1150" y="232" text-anchor="middle" font-family="'Yu Gothic','YuGothic','Hiragino Kaku Gothic ProN','Meiryo',sans-serif" font-size="20" font-weight="700" fill="#1F2937">注入実行</text><rect x="770" y="340" width="260" height="92" rx="12" fill="#F8FCFD" stroke="#2F9BB2" stroke-width="3"></rect><text x="900" y="374" text-anchor="middle" font-family="'Yu Gothic','YuGothic','Hiragino Kaku Gothic ProN','Meiryo',sans-serif" font-size="20" font-weight="700" fill="#1F2937">例示数削減</text><text x="900" y="402" text-anchor="middle" font-family="'Yu Gothic','YuGothic','Hiragino Kaku Gothic ProN','Meiryo',sans-serif" font-size="16" fill="#334155">budget_reduction</text><rect x="770" y="470" width="260" height="92" rx="12" fill="#F8FCFD" stroke="#2F9BB2" stroke-width="3"></rect><text x="900" y="504" text-anchor="middle" font-family="'Yu Gothic','YuGothic','Hiragino Kaku Gothic ProN','Meiryo',sans-serif" font-size="20" font-weight="700" fill="#1F2937">内容切り詰め</text><text x="900" y="532" text-anchor="middle" font-family="'Yu Gothic','YuGothic','Hiragino Kaku Gothic ProN','Meiryo',sans-serif" font-size="16" fill="#334155">budget_truncate</text><rect x="710" y="600" width="380" height="92" rx="12" fill="#F8FCFD" stroke="#2F9BB2" stroke-width="3"></rect><text x="900" y="634" text-anchor="middle" font-family="'Yu Gothic','YuGothic','Hiragino Kaku Gothic ProN','Meiryo',sans-serif" font-size="20" font-weight="700" fill="#1F2937">注入停止＋基線回帰</text><text x="900" y="662" text-anchor="middle" font-family="'Yu Gothic','YuGothic','Hiragino Kaku Gothic ProN','Meiryo',sans-serif" font-size="16" fill="#334155">budget_exceeded_disable</text><line x1="240" y1="231" x2="290" y2="231" stroke="#2F9BB2" stroke-width="2.6" marker-end="url(#arrow)"></line><line x1="520" y1="231" x2="560" y2="231" stroke="#2F9BB2" stroke-width="2.6" marker-end="url(#arrow)"></line><line x1="780" y1="231" x2="800" y2="231" stroke="#2F9BB2" stroke-width="2.6" marker-end="url(#arrow)"></line><line x1="1000" y1="231" x2="1060" y2="231" stroke="#2F9BB2" stroke-width="2.6" marker-end="url(#arrow)"></line><text x="1030" y="223" text-anchor="middle" font-family="'Yu Gothic','YuGothic','Hiragino Kaku Gothic ProN','Meiryo',sans-serif" font-size="18" font-weight="700" fill="#1F2937">Yes</text><line x1="900" y1="305" x2="900" y2="340" stroke="#2F9BB2" stroke-width="2.6" marker-end="url(#arrow)"></line><text x="900" y="314.5" text-anchor="middle" font-family="'Yu Gothic','YuGothic','Hiragino Kaku Gothic ProN','Meiryo',sans-serif" font-size="18" font-weight="700" fill="#1F2937">No</text><line x1="900" y1="432" x2="900" y2="470" stroke="#2F9BB2" stroke-width="2.6" marker-end="url(#arrow)"></line><line x1="900" y1="562" x2="900" y2="600" stroke="#2F9BB2" stroke-width="2.6" marker-end="url(#arrow)"></line><rect x="40" y="336" width="620" height="336" rx="12" fill="#FFFBEB" stroke="#EAB308" stroke-width="2"></rect><text x="64" y="372" font-family="'Yu Gothic','YuGothic','Hiragino Kaku Gothic ProN','Meiryo',sans-serif" font-size="22" font-weight="800" fill="#92400E">品質選別基準（簡易）</text><text x="68" y="416" font-family="'Yu Gothic','YuGothic','Hiragino Kaku Gothic ProN','Meiryo',sans-serif" font-size="18" fill="#334155">1) quality_score &gt;= 85（minScore）</text><text x="68" y="472" font-family="'Yu Gothic','YuGothic','Hiragino Kaku Gothic ProN','Meiryo',sans-serif" font-size="18" fill="#334155">2) テンプレ完全性：三語構造・例句・audio_tasks</text><text x="68" y="528" font-family="'Yu Gothic','YuGothic','Hiragino Kaku Gothic ProN','Meiryo',sans-serif" font-size="18" fill="#334155">3) 品質次元：completeness / accuracy / example / formatting</text><text x="68" y="584" font-family="'Yu Gothic','YuGothic','Hiragino Kaku Gothic ProN','Meiryo',sans-serif" font-size="18" fill="#334155">4) 同点時：入力との類似度（bigram）上位を優先</text><text x="40" y="704" font-family="'Yu Gothic','YuGothic','Hiragino Kaku Gothic ProN','Meiryo',sans-serif" font-size="12" fill="#64748B">Source: generation pipeline few-shot budget guard flow</text></svg>