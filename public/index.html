<!doctype html>
<html lang="zh-Hans">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trilingual Records Viewer</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <!-- Noto Serif for Academic Style -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Noto+Serif:wght@400;700&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="modern-card.css" />
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.9/dist/purify.min.js"></script>
  </head>
  <body>
    <div class="page">
      <header class="hero">
        <div style="width: 100%; display: flex; justify-content: space-between; align-items: center;">
          <div>
            <p class="eyebrow">Trilingual Records</p>
          </div>
          <a href="dashboard.html" class="dashboard-link" target="_blank" style="color: #666; text-decoration: none; font-size: 0.9rem; border: 1px solid #ddd; padding: 6px 12px; border-radius: 6px; background: white; transition: all 0.2s;">
            🚀 Mission Control
          </a>
        </div>
<!--        <div class="pill" id="sourceHint">数据源通过服务端环境变量配置</div>-->
      </header>

      <section class="grid">
        <article class="card folders" aria-label="Folders">
          <!-- Generation Panel -->
          <div class="gen-panel">
            <p class="label">New Card</p>

            <!-- 模型选择器 -->
            <div class="model-selector">
              <div class="selector-header">
                <span class="selector-label">模型选择</span>
                <span class="selector-hint" id="modelHint">LOCAL LLM</span>
              </div>
              <div class="selector-buttons">
                <button class="model-btn" data-mode="local" title="使用本地 LLM (Qwen)">
                  <span class="model-icon">🏠</span>
                  <span>LOCAL</span>
                </button>
                <button class="model-btn" data-mode="gemini" title="使用 Gemini API">
                  <span class="model-icon">🤖</span>
                  <span>GEMINI</span>
                </button>
                <button class="model-btn" data-mode="compare" title="双模型对比">
                  <span class="model-icon">⚡</span>
                  <span>COMPARE</span>
                </button>
              </div>
            </div>

            <div class="input-modes">
              <!-- 文本输入 -->
              <div class="input-mode">
                <div class="mode-header">
                  <span class="mode-icon">📝</span>
                  <span>文本输入</span>
                </div>
                <textarea id="phraseInput" placeholder="输入短语或句子..."></textarea>
                <button id="genBtn" class="btn-primary">Generate</button>
              </div>

              <!-- 图片识别 -->
              <div class="input-mode">
                <div class="mode-header">
                  <span class="mode-icon">🖼️</span>
                  <span>图片识别</span>
                </div>
                <div id="imageDropZone" class="image-drop-zone">
                  <div class="drop-hint">Ctrl+V 粘贴或拖拽图片</div>
                  <img id="imagePreview" class="hidden" alt="预览" />
                </div>
                <div class="image-actions">
                  <button id="ocrBtn" class="btn-secondary" disabled>识别文字</button>
                  <button id="clearImageBtn" class="btn-text" disabled>清除</button>
                </div>
              </div>
            </div>

            <!-- 进度指示器 -->
            <div id="progressBar" class="progress-bar hidden">
              <div class="progress-header">
                <div class="progress-prompt">
                  <span class="prompt-label">Prompt:</span>
                  <span id="promptText" class="prompt-text"></span>
                </div>
                <div id="progressTimer" class="progress-timer">00:00</div>
              </div>
              <div class="progress-steps">
                <div class="step" data-step="init">
                  <div class="step-dot"></div>
                  <div class="step-label">初始化</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="ocr">
                  <div class="step-dot"></div>
                  <div class="step-label">图像识别</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="prompt">
                  <div class="step-dot"></div>
                  <div class="step-label">构建Prompt</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="llm">
                  <div class="step-dot"></div>
                  <div class="step-label">LLM生成</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="parse">
                  <div class="step-dot"></div>
                  <div class="step-label">解析结果</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="render">
                  <div class="step-dot"></div>
                  <div class="step-label">渲染HTML</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="save">
                  <div class="step-dot"></div>
                  <div class="step-label">保存文件</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="audio">
                  <div class="step-dot"></div>
                  <div class="step-label">生成音频</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="complete">
                  <div class="step-dot"></div>
                  <div class="step-label">完成</div>
                </div>
              </div>
              <p id="progressStatus" class="progress-status"></p>
            </div>
          </div>

          <!-- 资源区 Tabs -->
          <div class="panel-tabs sub-tabs">
            <button class="tab-btn active" data-tab="folders">文件夹</button>
            <button class="tab-btn" data-tab="history">历史记录</button>
          </div>

          <!-- Folders Panel -->
          <div class="folders-panel tab-content active" data-content="folders">
            <div class="card-header">
              <div>
                <p class="label">Path</p>
                <h2>Date</h2>
              </div>
              <div class="chip" id="folderCount">0</div>
            </div>
            <div class="list" id="folderList" role="listbox" aria-label="folder list"></div>
          </div>

          <!-- History Panel -->
          <div class="history-panel tab-content" data-content="history">
            <div class="card-header">
              <div>
                <p class="label">Database</p>
                <h2>历史记录</h2>
              </div>
              <div class="chip" id="historyCount">0</div>
            </div>

            <!-- 搜索和过滤 -->
            <div class="history-filters">
              <input type="text" id="historySearch" placeholder="🔍 搜索短语或翻译..." class="search-input" />
              <select id="historyProviderFilter" class="filter-select">
                <option value="">所有提供商</option>
                <option value="local">Local LLM</option>
                <option value="gemini">Gemini</option>
              </select>
            </div>

            <!-- 历史记录列表 -->
            <div class="list history-list" id="historyList" role="listbox" aria-label="history list">
              <div class="loading-hint">加载中...</div>
            </div>

            <!-- 分页控件 -->
            <div class="history-pagination" id="historyPagination">
              <button id="historyPrevBtn" class="btn-text" disabled>← 上一页</button>
              <span id="historyPageInfo" class="page-info">1 / 1</span>
              <button id="historyNextBtn" class="btn-text" disabled>下一页 →</button>
            </div>
          </div>
        </article>

        <article class="card viewer" aria-label="Viewer">
<!--          <div class="card-header">-->
<!--            <div>-->
<!--              <p class="label">右侧区域</p>-->
<!--              <h2>HTML 清单与预览弹窗</h2>-->
<!--            </div>-->
<!--          </div>-->
          <div class="file-panel">
            <div class="card-header sub">
              <div>
                <p class="label">FileName</p>
                <h3>Phrase List</h3>
                <p class="muted small">Click to Browse</p>
              </div>
              <div class="chip" id="fileCount">0</div>
            </div>
            <div class="list file-list" id="fileList" role="listbox" aria-label="file list"></div>
          </div>
        </article>
      </section>

      <div id="modalOverlay" class="modal hidden" aria-modal="true" role="dialog">
        <div class="modal-content" id="modalContainer">
            <!-- Content injected via JS -->
        </div>
      </div>

      <!-- 右键菜单 -->
      <div id="contextMenu" class="context-menu hidden">
        <div class="context-menu-item" data-action="delete">
          <span class="context-menu-icon">🗑️</span>
          <span>删除记录</span>
        </div>
      </div>
    </div>
    <!-- Libraries -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script type="module" src="js/modules/app.js"></script>
  </body>
</html>
