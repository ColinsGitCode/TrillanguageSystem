<!doctype html>
<html lang="zh-Hans">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trilingual Records Viewer</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <!-- Noto Serif for Academic Style -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Noto+Serif:wght@400;700&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="modern-card.css" />
    <link rel="stylesheet" href="observability.css" />
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.9/dist/purify.min.js"></script>
  </head>
  <body>
    <div class="page">
      <header class="hero">
        <div>
          <p class="eyebrow">Trilingual Records</p>
<!--          <h1>HTML 记录浏览面板</h1>-->
<!--          <p class="lede">左上选择文件夹，右侧查看 HTML 清单，点击文件后会以大尺寸弹窗显示内容。</p>-->
        </div>
<!--        <div class="pill" id="sourceHint">数据源通过服务端环境变量配置</div>-->
      </header>

      <section class="grid">
        <article class="card folders" aria-label="Folders">
          <!-- Generation Panel -->
          <div class="gen-panel">
            <p class="label">New Card</p>

            <div class="input-modes">
              <!-- 文本输入 -->
              <div class="input-mode">
                <div class="mode-header">
                  <span class="mode-icon">📝</span>
                  <span>文本输入</span>
                </div>
                <textarea id="phraseInput" placeholder="输入短语或句子..."></textarea>
                <button id="genBtn" class="btn-primary">Generate</button>
              </div>

              <!-- 图片识别 -->
              <div class="input-mode">
                <div class="mode-header">
                  <span class="mode-icon">🖼️</span>
                  <span>图片识别</span>
                </div>
                <div id="imageDropZone" class="image-drop-zone">
                  <div class="drop-hint">Ctrl+V 粘贴或拖拽图片</div>
                  <img id="imagePreview" class="hidden" alt="预览" />
                </div>
                <div class="image-actions">
                  <button id="ocrBtn" class="btn-secondary" disabled>识别文字</button>
                  <button id="clearImageBtn" class="btn-text" disabled>清除</button>
                </div>
              </div>
            </div>

            <!-- Prompt 显示框 -->
            <div id="promptDisplay" class="prompt-display hidden">
              <div class="prompt-display-header">
                <span class="prompt-display-title">📋 完整 Prompt</span>
                <button id="togglePromptBtn" class="btn-text">收起</button>
              </div>
              <pre id="promptContent" class="prompt-content"></pre>
            </div>

            <!-- LLM 输出显示框 -->
            <div id="outputDisplay" class="prompt-display hidden">
              <div class="prompt-display-header">
                <span class="prompt-display-title">🧾 完整 LLM 输出</span>
                <button id="toggleOutputBtn" class="btn-text">收起</button>
              </div>
              <pre id="outputContent" class="prompt-content"></pre>
            </div>

            <!-- 进度指示器 -->
            <div id="progressBar" class="progress-bar hidden">
              <div class="progress-header">
                <div class="progress-prompt">
                  <span class="prompt-label">Prompt:</span>
                  <span id="promptText" class="prompt-text"></span>
                </div>
                <div id="progressTimer" class="progress-timer">00:00</div>
              </div>
              <div class="progress-steps">
                <div class="step" data-step="ocr">
                  <div class="step-dot"></div>
                  <div class="step-label">识别文字</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="generate">
                  <div class="step-dot"></div>
                  <div class="step-label">生成内容</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="save">
                  <div class="step-dot"></div>
                  <div class="step-label">保存文件</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="audio">
                  <div class="step-dot"></div>
                  <div class="step-label">生成音频</div>
                </div>
              </div>
              <p id="progressStatus" class="progress-status"></p>
            </div>

            <!-- F9: 对比模式控件 -->
            <div class="comparison-controls">
              <label class="comparison-toggle">
                <input type="checkbox" id="enableCompare" />
                <span>启用对比模式 (Gemini vs Local LLM)</span>
              </label>
            </div>

            <!-- 可观测性面板 -->
            <div id="observabilityPanel" class="observability-panel hidden">

              <!-- F1: Token 统计 -->
              <div class="obs-section token-stats">
                <h4 class="obs-title">📊 Token 使用情况</h4>
                <div class="token-grid">
                  <div class="token-item">
                    <span class="token-label">Input</span>
                    <span class="token-value" id="tokenInput">-</span>
                  </div>
                  <div class="token-item">
                    <span class="token-label">Output</span>
                    <span class="token-value" id="tokenOutput">-</span>
                  </div>
                  <div class="token-item">
                    <span class="token-label">Total</span>
                    <span class="token-value" id="tokenTotal">-</span>
                  </div>
                  <div class="token-item">
                    <span class="token-label">Cost</span>
                    <span class="token-value" id="tokenCost">$0.000</span>
                  </div>
                </div>
                <div class="quota-bar">
                  <div class="quota-label">
                    <span>今日配额</span>
                    <span id="quotaText">0/1,500</span>
                  </div>
                  <div class="quota-progress">
                    <div class="quota-fill" id="quotaFill" style="width: 0%"></div>
                  </div>
                </div>
              </div>

              <!-- F2: 性能指标 -->
              <div class="obs-section performance-metrics">
                <h4 class="obs-title">⚡ 性能分析</h4>
                <div class="perf-summary">
                  <div class="perf-total">
                    <span class="perf-value" id="perfTotal">-</span>
                    <span class="perf-label">总耗时</span>
                  </div>
                </div>
                <div class="perf-breakdown">
                  <div class="perf-phase">
                    <span class="phase-name">Prompt 构建</span>
                    <div class="phase-bar-container">
                      <div class="phase-bar" id="perfPromptBar" style="width: 0%"></div>
                    </div>
                    <span class="phase-time" id="perfPromptTime">-</span>
                  </div>
                  <div class="perf-phase">
                    <span class="phase-name">LLM 调用</span>
                    <div class="phase-bar-container">
                      <div class="phase-bar" id="perfLlmBar" style="width: 0%"></div>
                    </div>
                    <span class="phase-time" id="perfLlmTime">-</span>
                  </div>
                  <div class="perf-phase">
                    <span class="phase-name">JSON 解析</span>
                    <div class="phase-bar-container">
                      <div class="phase-bar" id="perfParseBar" style="width: 0%"></div>
                    </div>
                    <span class="phase-time" id="perfParseTime">-</span>
                  </div>
                  <div class="perf-phase">
                    <span class="phase-name">文件保存</span>
                    <div class="phase-bar-container">
                      <div class="phase-bar" id="perfSaveBar" style="width: 0%"></div>
                    </div>
                    <span class="phase-time" id="perfSaveTime">-</span>
                  </div>
                </div>
              </div>

              <!-- F7: 质量评分 -->
              <div class="obs-section quality-score">
                <h4 class="obs-title">✨ 内容质量</h4>
                <div class="quality-main">
                  <div class="quality-circle">
                    <svg viewBox="0 0 100 100">
                      <circle cx="50" cy="50" r="40" class="quality-bg"></circle>
                      <circle cx="50" cy="50" r="40" class="quality-progress"
                              id="qualityCircle"
                              style="stroke-dasharray: 251; stroke-dashoffset: 251"></circle>
                    </svg>
                    <div class="quality-score-value" id="qualityScore">-</div>
                  </div>
                  <div class="quality-checks" id="qualityChecks">
                    <!-- 动态生成质量检查项 -->
                  </div>
                </div>
                <div class="quality-warnings hidden" id="qualityWarnings"></div>
              </div>

              <!-- F5: Prompt 结构 -->
              <div class="obs-section prompt-structure">
                <h4 class="obs-title">📋 Prompt 结构</h4>
                <div class="prompt-tabs">
                  <button class="prompt-tab active" data-tab="full">完整 Prompt</button>
                  <button class="prompt-tab" data-tab="structure">结构化视图</button>
                </div>
                <div class="prompt-tab-content">
                  <div class="prompt-tab-panel active" id="promptFull">
                    <pre id="promptFullContent"></pre>
                  </div>
                  <div class="prompt-tab-panel" id="promptStructure">
                    <div class="prompt-section">
                      <h5>🎯 System Instruction</h5>
                      <pre id="promptSystem"></pre>
                    </div>
                    <div class="prompt-section">
                      <h5>🧠 Chain of Thought</h5>
                      <ol id="promptCoT"></ol>
                    </div>
                    <div class="prompt-section">
                      <h5>📚 Few-shot Examples</h5>
                      <div id="promptExamples"></div>
                    </div>
                    <div class="prompt-section">
                      <h5>✅ Quality Standards</h5>
                      <ul id="promptStandards"></ul>
                    </div>
                    <div class="prompt-section">
                      <h5>📝 User Input</h5>
                      <pre id="promptUserInput"></pre>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>

          <div class="card-header">
            <div>
              <p class="label">Path</p>
              <h2>Date</h2>
            </div>
            <div class="chip" id="folderCount">0</div>
          </div>
          <div class="list" id="folderList" role="listbox" aria-label="folder list"></div>
        </article>

        <article class="card viewer" aria-label="Viewer">
<!--          <div class="card-header">-->
<!--            <div>-->
<!--              <p class="label">右侧区域</p>-->
<!--              <h2>HTML 清单与预览弹窗</h2>-->
<!--            </div>-->
<!--          </div>-->
          <div class="file-panel">
            <div class="card-header sub">
              <div>
                <p class="label">FileName</p>
                <h3>Phrase List</h3>
                <p class="muted small">Click to Browse</p>
              </div>
              <div class="chip" id="fileCount">0</div>
            </div>
            <div class="list file-list" id="fileList" role="listbox" aria-label="file list"></div>
          </div>
          <div class="viewer-note">
<!--            <p>选中文件后，内容会在全屏弹窗中展示。点击弹窗外即可关闭。</p>-->
          </div>
        </article>
      </section>

      <div id="modalOverlay" class="modal hidden" aria-modal="true" role="dialog">
        <div class="modal-content" id="modalContainer">
            <!-- Content injected via JS -->
        </div>
      </div>

      <!-- F3: 健康状态面板 -->
      <div id="healthPanel" class="health-panel">
        <button id="healthToggle" class="health-toggle">
          <span class="health-icon">🏥</span>
          <span class="health-text">系统状态</span>
        </button>
        <div class="health-content hidden">
          <h4>服务健康状态</h4>
          <div id="healthServices" class="health-services">
            <!-- 动态生成服务状态 -->
          </div>
          <div class="health-storage">
            <h5>存储空间</h5>
            <div class="storage-bar">
              <div class="storage-fill" id="storageFill" style="width: 0%"></div>
            </div>
            <span class="storage-text" id="storageText">-</span>
          </div>
          <button id="healthRefresh" class="btn-secondary">刷新状态</button>
        </div>
      </div>

      <!-- F9: 对比模式结果模态框 -->
      <div id="comparisonModal" class="modal hidden">
        <div class="modal-content comparison-view">
          <button class="modal-close" onclick="closeComparisonModal()">×</button>
          <h2>🔍 模型对比分析</h2>

          <div class="comparison-grid">
            <div class="comparison-panel">
              <div class="comparison-header gemini">
                <h3>🤖 Gemini API</h3>
                <span class="comparison-status" id="geminiStatus"></span>
              </div>
              <div class="comparison-metrics" id="geminiMetrics"></div>
              <div class="comparison-output" id="geminiOutput"></div>
            </div>

            <div class="comparison-panel">
              <div class="comparison-header local">
                <h3>🖥️ Local LLM</h3>
                <span class="comparison-status" id="localStatus"></span>
              </div>
              <div class="comparison-metrics" id="localMetrics"></div>
              <div class="comparison-output" id="localOutput"></div>
            </div>
          </div>

          <div class="comparison-summary">
            <h3>📊 对比总结</h3>
            <div class="comparison-winner" id="comparisonWinner"></div>
            <div class="comparison-recommendation" id="comparisonRec"></div>
          </div>
        </div>
      </div>
    </div>
    <script src="main.js" defer></script>
  </body>
</html>
